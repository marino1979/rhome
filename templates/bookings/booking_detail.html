{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Prenotazione" %} #{{ booking.id }} - Rhome Book{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="bg-blue-600 text-white p-6 rounded-lg mb-8">
        <h1 class="text-2xl font-bold">{% trans "Prenotazione" %} #{{ booking.id }}</h1>
        <p class="mt-2"><strong>{{ booking.listing.title }}</strong></p>
        <div class="mt-3 flex flex-wrap gap-2">
            <span class="px-3 py-1 rounded-full text-sm font-bold
                {% if booking.status == 'confirmed' %}bg-green-500
                {% elif booking.status == 'pending' %}bg-yellow-500 text-black
                {% elif booking.status == 'cancelled' %}bg-red-500
                {% else %}bg-gray-500{% endif %}">
                {{ booking.get_status_display }}
            </span>
            <span class="px-3 py-1 rounded-full text-sm font-bold
                {% if booking.payment_status == 'paid' %}bg-green-500
                {% elif booking.payment_status == 'pending' %}bg-yellow-500 text-black
                {% else %}bg-gray-500{% endif %}">
                {{ booking.get_payment_status_display }}
            </span>
        </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
        <div class="bg-gray-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold mb-4">{% trans "Dettagli Soggiorno" %}</h3>
            <p class="mb-2"><strong>{% trans "Check-in:" %}</strong> {{ booking.check_in_date }}</p>
            <p class="mb-2"><strong>{% trans "Check-out:" %}</strong> {{ booking.check_out_date }}</p>
            <p class="mb-2"><strong>{% trans "Notti:" %}</strong> {{ booking.total_nights }}</p>
            <p class="mb-2"><strong>{% trans "Ospiti:" %}</strong> {{ booking.num_guests }} ({{ booking.num_adults }} {% trans "adulti" %}, {{ booking.num_children }} {% trans "bambini" %})</p>

            {% if booking.check_in_code %}
                <p class="mb-2"><strong>{% trans "Codice Accesso:" %}</strong> <span class="text-xl text-blue-600 font-bold">{{ booking.check_in_code }}</span></p>
            {% endif %}

            {% if booking.special_requests %}
                <p class="mb-2"><strong>{% trans "Richieste Speciali:" %}</strong></p>
                <p class="text-gray-600">{{ booking.special_requests }}</p>
            {% endif %}
        </div>

        <div class="bg-gray-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold mb-4">{% trans "Riepilogo Prezzi" %}</h3>
            <div class="flex justify-between mb-2">
                <span>€{{ booking.base_price_per_night }} x {{ booking.total_nights }} {% trans "notti" %}</span>
                <span>€{{ booking.subtotal }}</span>
            </div>

            {% if booking.cleaning_fee > 0 %}
            <div class="flex justify-between mb-2">
                <span>{% trans "Pulizie" %}</span>
                <span>€{{ booking.cleaning_fee }}</span>
            </div>
            {% endif %}

            {% if booking.extra_guest_fee > 0 %}
            <div class="flex justify-between mb-2">
                <span>{% trans "Ospiti extra" %}</span>
                <span>€{{ booking.extra_guest_fee }}</span>
            </div>
            {% endif %}

            <div class="flex justify-between font-bold text-lg border-t-2 border-blue-600 pt-3 mt-3">
                <span>{% trans "Totale" %}</span>
                <span>€{{ booking.total_amount }}</span>
            </div>
        </div>
    </div>

    <div class="bg-gray-50 p-6 rounded-lg mb-8">
        <h3 class="text-lg font-semibold mb-4">{% trans "Contatti" %}</h3>
        <p class="mb-2"><strong>{% trans "Email:" %}</strong> {{ booking.guest_email|default:booking.guest.email }}</p>
        {% if booking.guest_phone %}
            <p class="mb-2"><strong>{% trans "Telefono:" %}</strong> {{ booking.guest_phone }}</p>
        {% endif %}
        <p class="mb-2"><strong>{% trans "Prenotazione effettuata:" %}</strong> {{ booking.created_at }}</p>
    </div>

    {% if payments %}
    <div class="bg-gray-50 p-6 rounded-lg mb-8">
        <h3 class="text-lg font-semibold mb-4">{% trans "Pagamenti" %}</h3>
        {% for payment in payments %}
            <div class="flex justify-between mb-2">
                <span>{{ payment.get_payment_type_display }} - {{ payment.payment_date|date:"d/m/Y H:i" }}</span>
                <span>€{{ payment.amount }}</span>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if can_cancel %}
    <div class="text-center mb-6">
        <a href="{% url 'bookings:cancel_booking' booking.id %}" class="inline-block bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg">
            {% trans "Cancella Prenotazione" %}
        </a>
    </div>
    {% endif %}

    <div class="text-center">
        <a href="{% url 'bookings:booking_list' %}" class="text-blue-600 hover:text-blue-800">
            ← {% trans "Torna alle Mie Prenotazioni" %}
        </a>
    </div>
</div>
{% endblock %}
